<!DOCTYPE html>
<html lang="ja">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, minimum-scale=1.0, maximum-scale=1.0">
    <title>検温くん</title>
    <link rel="stylesheet" href="../static/style.css">
  </head>
  <body>
    <div id="top-container">
      <img id="top-img" src="../static/ken-on-top.png">
    </div>
  
    <div class="module-container">
      <form action="{{ url_for('add_entry') }}" method=post autocomplete="on">
        <div class="qa-area">
          <div class="jcode-box" >
            <div class="qa-set">
              <div class="q-line">
                <p>社員コードは？</p>
              </div>
              <div class="a-form">
                <input type="text" name="jcode" id="input1" maxlength="7">
              </div>
            </div>
            <div class="alert-line">
              <p id="alert1"> ※ 半角英数字で７ケタ</p>
            </div>
          </div>
          <div class="temp-box">
            <div class="qa-set">
              <div class="q-line">
                <p>体温は？</p>
              </div>
              <div class="a-form">
                <input type="text" name="temp" id="input2" maxlength="4">
              </div>
            </div>
            <div class="alert-line">
              <p id="alert2"> ※ 35.0以上41.0未満</p>
            </div>
          </div>
        </div>
          
        <div class="extra-area">
          <div>
            <button type="button" id="extra-btn">＋</button>
          </div>
          <div id="extra-box">
            <div class="checkbox-set">
              <div class="extra-checkbox">
                <input type="checkbox" name="breathlessness" value="1" id="input3"> 息苦しさ
                <input type="hidden" name="breathlessness" value="0" id="input3">
              </div>
              <div class="extra-checkbox">
                <input type="checkbox" name="dullness" value="1" id="input4"> 強いだるさ
                <input type="hidden" name="dullness" value="0" id="input4">
              </div>
            </div>
            <div class="extra-commnent">
              <input type="text" name="comment" placeholder="その他メモ欄"　id="input5">
            </div>
          </div>
        </div>

        <div class="submit-area">
          <button type="submit" id="enter-btn">これで登録</button>
        </div>
      </form>
    </div>

    <div class="module-container">
      <div class="logs-area">
        <p>[新着５件]</p>
        <div class="logs-box5">
          <table class="logs-table" align=left>
            <thead>
              <!-- trは列要素 -->
              <tr>
                <!-- thは見出しセル（自動で太字中央寄せ）-->
                <th>登録日時</th>
                <th>体温</th>
                <th>社員コード</th>
              </tr>
            </thead>
            <tbody>
              {% for entry in entries_head %}
              <tr>
                <!-- tdは通常セル -->
                <td>{{entry.date.strftime('%a %m-%d %H:%M')}}</td>
                <td>{{entry.temp}}</td>
                <td>{{entry.jcode}}</td>
              </tr>
              {% endfor %}
            </tbody>
          </table>
        </div>
      </div>

      <form action="{{ url_for('specify_logs') }}" method=post>
        <div class="submit-area">
          <button type="submit" id="std-btn">履歴を検索</button>
        </div>
      </form>
    </div>

    <div class="container" id="admin-link">
      <p>管理者用：<a href="/download/all">全データ出力</a></p>
    </div>


    <script type="text/javascript">
    //1.最初から社員コード欄（id="input1"）にカーソルを合わせておく
      document.getElementById('input1').focus();
    //2.input1に英数字で7桁埋まったら・・・
      const input1 = document.querySelector("#input1");   //id名を#で指定
      input1.addEventListener("keyup", function(){    // id=”input1"内でキーを押して離したら発火、{}内を作動
        if (/([a-z]|[A-Z]|\d){7}/.test(this.value)) {
          this.style.borderColor = "#66AB8D";
          this.value = this.value.toUpperCase();  // 小文字を大文字に変換
          document.getElementById("alert1").textContent = ""; //アラート文を非表示に
        } else{
          this.style.borderColor = "#d3d3d3";
          document.getElementById("alert1").textContent = "※ 半角英数字で７ケタ";
        }
      },false);
      input1.addEventListener("blur", function(){    // id=”input1"がフォーカスを失ったら、{}内を作動
        if (/([a-z]|[A-Z]|\d){7}/.test(this.value)) {
          this.value = this.value.toUpperCase();  // 小文字を大文字に変換
        } 
      },false);
    //3.input2に”35.0〜40.9までの数"が入ったら・・・
      const input2 = document.querySelector("#input2");
      input2.addEventListener("keyup", function(){ 
        const temperature = Number(input2.value);
        if (temperature>=35 && temperature<41) {
          this.style.borderColor = "#66AB8D";
          document.getElementById("alert2").textContent = "";
        } else{
          this.style.borderColor = "#d3d3d3";
          document.getElementById("alert2").textContent = "※ 35.0以上41.0未満";
        }
      },false);
    //4. 2と3が整ったらOKボタンを変更[非活性=>活性]、[グレー=>グリーン]、[マウスオーバー時矢印=>ポインタ]
      const enterbtn = document.querySelector("#enter-btn");
      const extrabtn = document.querySelector("#extra-btn");
      const extrabox = document.querySelector("#extra-box");
      window.addEventListener("DOMContentLoaded", function(){
        extrabtn.disabled = true;
        enterbtn.disabled = true;
        extrabox.style.display ="none";

        input1.addEventListener("keyup", function(){
          const temperature = Number(input2.value);
          if (/([A-Z]|\d){7}/.test(input1.value) && (temperature>=35 && temperature<41)){
            enterbtn.disabled = false;
            extrabtn.disabled = false;
            enterbtn.style.backgroundColor = "#66AB8D";
            extrabtn.style.backgroundColor = "#66AB8D";
            enterbtn.style.cursor = "pointer";
            extrabtn.style.cursor = "pointer";
          } else{
            enterbtn.disabled = true;
            extrabtn.disabled = true;
            enterbtn.style.backgroundColor = "#d3d3d3";
            extrabtn.style.backgroundColor = "#d3d3d3";
            enterbtn.style.cursor = "auto";
            extrabtn.style.cursor = "auto";
          }
        },false);
        // input2の編集中でも同じ動きが起こるようコピペ
        input2.addEventListener("keyup", function(){
          const temperature = Number(input2.value);
          if (/([A-Z]|\d){7}/.test(input1.value) && (temperature>=35 && temperature<41)) {
            enterbtn.disabled = false;
            extrabtn.disabled = false;
            enterbtn.style.backgroundColor = "#66AB8D";
            extrabtn.style.backgroundColor = "#66AB8D";
            enterbtn.style.cursor = "pointer";
            extrabtn.style.cursor = "pointer";
          } else{
            enterbtn.disabled = true;
            extrabtn.disabled = true;
            enterbtn.style.backgroundColor = "#d3d3d3";
            extrabtn.style.backgroundColor = "#d3d3d3";
            enterbtn.style.cursor = "auto";
            extrabtn.style.cursor = "auto";
          }
        },false);

        // extra-btnを押したらextra-boxが開く
        extrabtn.addEventListener("click", function(){ 
          if(extrabox.style.display=="block"){
		        extrabox.style.display ="none";
            extrabtn.innerHTML = "＋";
	        }else{
	        	extrabox.style.display ="block";
            extrabtn.innerHTML = "－";
	        } 
        },false);
      },false);
    </script>
  </body>
</html>


