<!DOCTYPE html>
<html lang="ja">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, minimum-scale=1.0, maximum-scale=1.0">
    <title>検温くん</title>
    <link rel="stylesheet" href="../static/style.css">
  </head>
  <body>
    <div class="h">
      <h1>検温しますよー</h1>
    </div>

    <form action="{{ url_for('add_entry') }}" method=post>
      <div class="module-container">
        <div class="qa-container">
          <div class="jcode-area" >
            <div class="qa-set">
              <div class="q-line">
                <p>社員コードは？</p>
              </div>
              <div class="a-form">
                <input type="text" name="jcode" id="input1" maxlength="7">
              </div>
            </div>
            <div class="alert-line">
              <p id="alert1"> ※ 半角英数字で７ケタ</p>
            </div>
          </div>
          <div class="temp-area">
            <div class="qa-set">
              <div class="q-line">
                <p>体温は？</p>
              </div>
              <div class="a-form">
                <input type="text" name="temp" id="input2" maxlength="4">
              </div>
            </div>
            <div class="alert-line">
              <p id="alert2"> ※ 35.0以上41.0未満</p>
            </div>
          </div>
        </div>
        <div class="submit-container">
          <button type="submit" id="submit">これでOK</button>
        </div>
      </div>
    </form>

    <div class="module-container">
      <div class="logs-container">
        <p>[新着５件]</p>
        <div id="logs-table">
          <table align=left>
            <thead>
              <!-- trは列要素 -->
              <tr>
                <!-- thは見出しセル（自動で太字中央寄せ）-->
                <th>登録日時</th>
                <th>体温</th>
                <th>社員コード</th>
              </tr>
            </thead>
            <tbody>
              {% for entry in entries_head %}
              <tr>
                <!-- tdは通常セル -->
                <td>{{entry.date.strftime('%a %m-%d %H:%M')}}</td>
                <td>{{entry.temp}}</td>
                <td>{{entry.jcode}}</td>
              </tr>
              {% endfor %}
            </tbody>
          </table>
        </div>
        <div class="spread-link">
          <p><a href="/logs-specify">履歴を検索</a></p>
        </div>
      </div>
    </div>

    <!-- ここからJavascript -->
    <script>
    //1.最初から社員コード欄（id="input1"）にカーソルを合わせておく
      document.getElementById('input1').focus();
    //2.input1に英数字で7桁埋まったら・・・
      const input1 = document.querySelector("#input1");   //id名を#で指定
      input1.addEventListener("keyup", function(){    // id=”input1"内でキーを押して離したら発火、{}内を作動
        if (/([a-z]|[A-Z]|\d){7}/.test(this.value)) {
          this.style.borderColor = "#66AB8D";
          this.value = this.value.toUpperCase();  // 小文字を大文字に変換
          document.getElementById("alert1").textContent = ""; //アラート文を非表示に
        } else{
          this.style.borderColor = "#d3d3d3";
          document.getElementById("alert1").textContent = "※ 半角英数字で７ケタ";
        }
      },false);
      input1.addEventListener("blur", function(){    // id=”input1"がフォーカスを失ったら、{}内を作動
        if (/([a-z]|[A-Z]|\d){7}/.test(this.value)) {
          this.value = this.value.toUpperCase();  // 小文字を大文字に変換
        } 
      },false);
    //3.input2に”35.0〜40.9までの数"が入ったら・・・
      const input2 = document.querySelector("#input2");
      input2.addEventListener("keyup", function(){ 
        const temperature = Number(input2.value);
        if (temperature>=35 && temperature<41) {
          this.style.borderColor = "#66AB8D";
          document.getElementById("alert2").textContent = "";
        } else{
          this.style.borderColor = "#d3d3d3";
          document.getElementById("alert2").textContent = "※ 35.0以上41.0未満";
        }
      },false);
    //4. 2と3が整ったらOKボタンを変更[非活性=>活性]、[グレー=>グリーン]、[マウスオーバー時矢印=>ポインタ]
      const button = document.querySelector("#submit");
      window.addEventListener("DOMContentLoaded", function(){
        button.disabled = true;
        input1.addEventListener("keyup", function(){
          const temperature = Number(input2.value);
          if (/([A-Z]|\d){7}/.test(input1.value) && (temperature>=35 && temperature<41)){
            button.disabled = false;
            button.style.backgroundColor = "#66AB8D";
            button.style.cursor = "pointer";
          } else{
            button.disabled = true;
            button.style.backgroundColor = "#d3d3d3";
            button.style.cursor = "auto";
          }
        },false);
      // input2の編集中でも同じ動きが起こるようコピペ
        input2.addEventListener("keyup", function(){
          const temperature = Number(input2.value);
          if (/([A-Z]|\d){7}/.test(input1.value) && (temperature>=35 && temperature<41)) {
            button.disabled = false;
            button.style.backgroundColor = "#66AB8D";
            button.style.cursor = "pointer";
          } else{
            button.disabled = true;
            button.style.backgroundColor = "#d3d3d3";
            button.style.cursor = "auto";
          }
        },false);
      },false);
    </script>
  </body>
</html>


